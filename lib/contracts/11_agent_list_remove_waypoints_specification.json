{
  "specification": "waypoint_swipe_remove",
  "version": "1.0",
  "description": "Remoção por swipe (Dismissible) para waypoints",
  "entity": {
    "name": "Waypoint",
    "properties": [
      {
        "name": "latitude",
        "type": "double",
        "range": "-90.0 a 90.0",
        "precision": 6,
        "description": "Coordenada de latitude"
      },
      {
        "name": "longitude",
        "type": "double",
        "range": "-180.0 a 180.0",
        "precision": 6,
        "description": "Coordenada de longitude"
      },
      {
        "name": "timestamp",
        "type": "DateTime",
        "description": "Data e hora de criação"
      }
    ]
  },
  "dismissible_structure": {
    "key": "ValueKey('${waypoint.latitude}_${waypoint.longitude}')",
    "direction": "DismissDirection.endToStart",
    "description": "Swipe da direita para esquerda"
  },
  "background_design": {
    "direction": "right-to-left",
    "color": "Colors.red",
    "icon": "Icons.delete",
    "alignment": "Alignment.centerRight",
    "padding": "EdgeInsets.only(right: 16)"
  },
  "confirmation_dialog": {
    "dismissible": false,
    "title": "Confirmar remoção",
    "message": "Remover waypoint em '{coordinates}'? Esta ação não pode ser desfeita.",
    "message_format": "latitude e longitude com 6 casas decimais",
    "example_message": "Remover waypoint em '-16.502301, -68.119301'? Esta ação não pode ser desfeita.",
    "actions": [
      {
        "label": "Cancelar",
        "return_value": false,
        "color": "Colors.grey"
      },
      {
        "label": "Remover",
        "return_value": true,
        "color": "Colors.red"
      }
    ]
  },
  "coordinate_formatting": {
    "precision": "6 casas decimais",
    "separator": ", ",
    "example": "-16.502301, -68.119301",
    "format_pattern": "{latitude}, {longitude}"
  },
  "behavior_flow": {
    "step_1": "Usuário faz swipe para esquerda em WaypointListItem",
    "step_2": "Background vermelho com ícone trash aparece com animação",
    "step_3": "Usuário libera o gesto ou toca no background",
    "step_4": "confirmDismiss é acionado",
    "step_5": "AlertDialog de confirmação abre (não-dismissable)",
    "step_6": "Usuário confirma ou cancela",
    "step_7a_confirm": "DAO remove o waypoint (try/catch)",
    "step_7b_success": "onDismissed é chamado, item desaparece com animação",
    "step_7c_snackbar": "SnackBar exibe 'Waypoint removido com sucesso'",
    "step_8_error": "Se erro: confirmDismiss retorna false, swipe reverte, SnackBar de erro"
  },
  "dao_integration": {
    "class": "WaypointsLocalDaoSharedPrefs",
    "method": "remove(String id) ou equivalente que remove o waypoint",
    "wrapped_in": "try/catch com feedback ao usuário"
  },
  "feedback_messages": {
    "success": {
      "type": "SnackBar",
      "message": "Waypoint removido com sucesso",
      "duration": "2 segundos"
    },
    "error": {
      "type": "SnackBar",
      "message": "Erro ao remover waypoint",
      "duration": "3 segundos"
    }
  },
  "confirmDismiss_implementation": {
    "signature": "Future<bool?> confirmDismiss(DismissDirection direction)",
    "logic": [
      "1. Validar direction == DismissDirection.endToStart",
      "2. Formatar coordenadas (6 casas decimais)",
      "3. Abrir showDialog com AlertDialog (barrierDismissible: false)",
      "4. Se usuário confirma: chamar DAO.remove(id) em try/catch",
      "5. Se sucesso: retornar true (executa onDismissed)",
      "6. Se erro: exibir SnackBar, retornar false (reverte swipe)",
      "7. Se usuário cancela: retornar false"
    ]
  },
  "onDismissed_implementation": {
    "signature": "void onDismissed(DismissDirection direction)",
    "logic": [
      "1. Atualizar estado da lista parent (setState ou notifyListeners)",
      "2. Exibir SnackBar de sucesso",
      "3. Opcionalmente: recarregar lista via _loadWaypoints() se necessário"
    ]
  },
  "acceptance_criteria": [
    "1. Swipe para esquerda exibe background vermelho com ícone trash",
    "2. Background aparece apenas ao swipear (não aparece por default)",
    "3. Ao completar ou tocar no background, abre AlertDialog",
    "4. AlertDialog é não-dismissable (apenas botões fecham)",
    "5. AlertDialog exibe título e mensagem com coordenadas (6 casas decimais)",
    "6. Coordenadas são formatadas corretamente: 'lat, lon'",
    "7. Botão 'Cancelar' reverte o swipe sem remover",
    "8. Botão 'Remover' chama DAO.remove() e remove item",
    "9. Se sucesso: SnackBar 'Waypoint removido com sucesso'",
    "10. Se erro: SnackBar 'Erro ao remover waypoint', swipe reverte",
    "11. Item desaparece com animação suave",
    "12. Lista recarrega ou atualiza estado após remoção",
    "13. Nenhuma lógica de edição/seleção é acionada",
    "14. Coordenadas exibidas em monospace para melhor alinhamento"
  ],
  "dependencies": {
    "imports": [
      "package:flutter/material.dart",
      "package:runsafe/domain/dto/waypoint_dto.dart",
      "package:runsafe/core/services/waypoints_local_dao.dart"
    ],
    "existing_files": [
      "lib/widgets/waypoint_list_item.dart",
      "lib/widgets/waypoint_list_widget.dart",
      "lib/services/waypoints_local_dao.dart"
    ]
  },
  "modification_points": {
    "file": "lib/widgets/waypoint_list_item.dart",
    "changes": [
      "Envolver ListTile em Dismissible widget",
      "Implementar confirmDismiss Future",
      "Implementar onDismissed callback",
      "Adicionar background com Container vermelho",
      "Formatar coordenadas com 6 casas decimais"
    ]
  },
  "error_scenarios": [
    {
      "scenario": "DAO falha ao remover",
      "handling": "try/catch captura erro, retorna false em confirmDismiss, exibe SnackBar de erro"
    },
    {
      "scenario": "Usuário cancela confirmação",
      "handling": "Retorna false, swipe reverte suavemente"
    },
    {
      "scenario": "Waypoint não encontrado",
      "handling": "DAO retorna erro, tratado como acima"
    }
  ],
  "animation_details": {
    "dismissible_animation": "default (suave)",
    "background_animation": "slide and fade in",
    "item_removal_animation": "default Flutter (suave saída)"
  },
  "coordinate_display_in_dialog": {
    "font": "Monospace (para alinhamento)",
    "format": "-16.502301, -68.119301",
    "precision": "6 casas decimais",
    "separator": ", (vírgula espaço)"
  },
  "testing_checklist": [
    "[ ] Swipe para esquerda exibe background",
    "[ ] Swipe para direita reverte",
    "[ ] Tap no background abre diálogo",
    "[ ] Diálogo é não-dismissable",
    "[ ] Coordenadas formatadas com 6 casas decimais",
    "[ ] Coordenadas em monospace",
    "[ ] Cancelar reverte swipe",
    "[ ] Remover chama DAO",
    "[ ] SnackBar de sucesso exibe",
    "[ ] SnackBar de erro exibe se falha",
    "[ ] Item desaparece com animação",
    "[ ] Lista permanece consistente",
    "[ ] Sem regredir edição/seleção"
  ],
  "ui_example": {
    "normal_state": "ListTile com waypoint",
    "swiped_state": "Background vermelho com ícone trash visível",
    "dialog_state": {
      "title": "Confirmar remoção",
      "body": "Remover waypoint em '-16.502301, -68.119301'? Esta ação não pode ser desfeita.",
      "buttons": ["Cancelar", "Remover"]
    }
  }
}
